



function load_timesheet_report() {
	var data = colect_config_date();
	if (data) {
		var method_get_url = encodeURIComponent(JSON.stringify(data));
		location.href = REPORT + '?' + method_get_url;
	}
}

$(document).ready(function () {
	$('#load').click(function(event) {
		load_timesheet_report();
	});
	$('.remove-row').click(function(event) {
		var tr = $(this).closest('tr');
		tr.remove();
	});
	
	
	$('#send_mail').click(function(event) {
		var data = {}; 
		var rows = $('#report_timesheet').find('tr');
		var  week = null;
		rows.each(function() {
			var email, resource, work_hours, timeoff, total, detail, comment;
			if ($(this).hasClass('week')) {
				week = $(this).find('td:first-child').html();
			} else if ($(this).hasClass('report-content')) {
				var td = $(this).find('td');
				td.each(function() {
					if ($(this).hasClass('email')) {
						email = $(this).html();
					} else if ($(this).hasClass('resource')) {
						resource = $(this).html();
					} else if ($(this).hasClass('work-hours')) {
						work_hours = $(this).html();
					} else if ($(this).hasClass('timeoff')) {
						timeoff = $(this).html();
					} else if ($(this).hasClass('total')) {
						total = $(this).html();
					} else if ($(this).hasClass('detail')) {
						detail = $(this).html();
					} else if ($(this).hasClass('comment')) {
						comment = $(this).html();
					}
				})
				if (data[email] == undefined) {
					data[email] = {};
				}
				if (data[email][week] == undefined) {
					data[email][week] = [];
				}
				data[email][week].push([resource, work_hours, timeoff, total, detail, comment]);
			}
		});
		get_template_content('components/sending_mail/report_timesheet.html', function(template) {
			
		});
	});
	$('.review-e-popup ul li span').click(function(){
		$('.mail-ctn').hide();
		var target_id = $(this).data("target");
		$(target_id).show();
	});
});

function create_send_mail_popup(data) {
	var popup_ctn = `<div class='review-e-popup'>
		<div class='review-e-title'>
			<span>Send Report</span>
		</div>
		<div  class='review-e-menu'>
			<ul>`
	var count = 0;
	var ctn = '';
	for (var [key, value] of Object.entries(data)) {
		count += 1;
				popup_ctn += '<li>'
				popup_ctn += "<input type='checkbox' data-target='#cnt_" + count + "'>";
				popup_ctn += "<span data-target='#cnt_" + count + "'>" + key + "</span>";	
				popup_ctn += '</li>';
				var mail_content = 'aaa';
				ctn += "<div id='cnt_" + count + "' class='mail-ctn dp-block' >" + mail_content + "</div>";
		}
	    popup_ctn += `</ul>
		</div>
		<div class='review-e-content'>`
		
		popup_ctn += ctn;
			
			
			
		popup_ctn += `</div>
		<div class='review-e-footer'>
			<button type='button' >Cancel</button>
			<button type='button' >Send</button>
		</div>
	</div>`
	
}



