'''
Created on Feb 5, 2021

@author: toannguyen
'''
import sys, re, os
from decimal import Decimal
from pprint import pprint
import smartsheet
from simple_smartsheet import Smartsheet
import datetime
import time, stat
from pprint import pprint
import xlwt
from jinja2 import Environment
from jinja2.loaders import FileSystemLoader
from config import TOKEN

from src.commons.Utils import CommonUtils

from src.commons import Enums
from builtins import None

class SmartSheets:
    def __init__(self, list_sheet=None):
        self.connection = None
        self.available_name = []
        self.connect_smartsheet()
        self.list_sheet = list_sheet
        
        self.info   = {}
        
        self.parse()
        
    def set_attr(self, **kwargs):                      
        for key, value in kwargs.items():
            setattr(self, key, value)
            
    def connect_smartsheet(self):
        self.connection = Smartsheet(TOKEN)
        self.get_available_sheet_name()
        
    def get_available_sheet_name(self):
        sheets = self.connection.sheets.list()
        for sheet in sheets:
            self.available_name.append(sheet.name)
    
    def parse(self):
        if self.list_sheet == None:
            pass
            # missing code
        else:
            list_sheet_name = []
            for sheet_name in self.list_sheet:
                if sheet_name in self.available_name:
                    list_sheet_name.append(sheet_name)
                else:
                    CommonUtils.stuck('No sheet name %s'%sheet_name)
            for sheet_name in list_sheet_name:
                info = Sheet(sheet_name)
                self.info[sheet_name] = info 
        
    
class Sheet(SmartSheets):
    def __init__(self, sheet_name):
        SmartSheets.__init__(self)
        self.children_task  = []
        self.parent_task    = []
        self.name           = sheet_name
        self.header_index    = {}
        self.parse_sheet()
        
    
        
    
    def parse_sheet(self):
        sheet           = self.connection.sheets.get(self.name)
        cols            = sheet.columns
        count = 0
        for col  in cols:
            header_name = col.title
            if header_name in Enums.SmartsheetCfgKeys.LIST_HEADER:
                self.header_index[header_name] = count
            count += 1
        rows = sheet.rows
        
        for row in rows:
            cells = row.cells
            print (type(cells))
#             for cell in cells:
#                 print (cell.display_value)
                
    
    
class Task(Sheet):
    def __init__(self, header_index, row):
        Sheet.__init__(self)
        self.self_id            = None
        self.sibling_id         = None
        self.parent_id          = None
        self.name               = None
        self.assign_to          = None
        self.start_date         = None
        self.end_date           = None
        self.duration           = None
        self.predecessors       = None
        self.comments           = None
        self.actual_end_date    = None
        self.status             = None
        
    self.parse_task()
        
    def parse_task(self):
        pass
        

    